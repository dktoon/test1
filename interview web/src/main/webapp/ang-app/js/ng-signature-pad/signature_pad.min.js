!function(t,o){"function"==typeof define&&define.amd?define([],function(){return t.SignaturePad=o()}):"object"==typeof exports?module.exports=o():t.SignaturePad=o()}(this,function(){var t=function(t){"use strict";var o=function(t,o){var e=this,n=o||{};this.velocityFilterWeight=n.velocityFilterWeight||.7,this.minWidth=n.minWidth||.5,this.maxWidth=n.maxWidth||2.5,this.dotSize=n.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=n.penColor||"black",this.backgroundColor=n.backgroundColor||"rgba(0,0,0,0)",this.onEnd=n.onEnd,this.onBegin=n.onBegin,this._canvas=t,this._ctx=t.getContext("2d"),this.clear(),this._handleMouseDown=function(t){1===t.which&&(e._mouseButtonDown=!0,e._strokeBegin(t))},this._handleMouseMove=function(t){e._mouseButtonDown&&e._strokeUpdate(t)},this._handleMouseUp=function(t){1===t.which&&e._mouseButtonDown&&(e._mouseButtonDown=!1,e._strokeEnd(t))},this._handleTouchStart=function(t){var o=t.changedTouches[0];e._strokeBegin(o)},this._handleTouchMove=function(t){t.preventDefault();var o=t.changedTouches[0];e._strokeUpdate(o)},this._handleTouchEnd=function(t){var o=t.target===e._canvas;o&&e._strokeEnd(t)},this._handleMouseEvents(),this._handleTouchEvents()};o.prototype.clear=function(){var t=this._ctx,o=this._canvas;t.fillStyle=this.backgroundColor,t.clearRect(0,0,o.width,o.height),t.fillRect(0,0,o.width,o.height),this._reset()},o.prototype.toDataURL=function(t,o){var e=this._canvas;return e.toDataURL.apply(e,arguments)},o.prototype.fromDataURL=function(t){var o=this,e=new Image,n=window.devicePixelRatio||1,i=this._canvas.width/n,s=this._canvas.height/n;this._reset(),e.src=t,e.onload=function(){o._ctx.drawImage(e,0,0,i,s)},this._isEmpty=!1},o.prototype._strokeUpdate=function(t){var o=this._createPoint(t);this._addPoint(o)},o.prototype._strokeBegin=function(t){this._reset(),this._strokeUpdate(t),"function"==typeof this.onBegin&&this.onBegin(t)},o.prototype._strokeDraw=function(t){var o=this._ctx,e="function"==typeof this.dotSize?this.dotSize():this.dotSize;o.beginPath(),this._drawPoint(t.x,t.y,e),o.closePath(),o.fill()},o.prototype._strokeEnd=function(t){var o=this.points.length>2,e=this.points[0];!o&&e&&this._strokeDraw(e),"function"==typeof this.onEnd&&this.onEnd(t)},o.prototype._handleMouseEvents=function(){this._mouseButtonDown=!1,this._canvas.addEventListener("mousedown",this._handleMouseDown),this._canvas.addEventListener("mousemove",this._handleMouseMove),t.addEventListener("mouseup",this._handleMouseUp)},o.prototype._handleTouchEvents=function(){this._canvas.style.msTouchAction="none",this._canvas.addEventListener("touchstart",this._handleTouchStart),this._canvas.addEventListener("touchmove",this._handleTouchMove),t.addEventListener("touchend",this._handleTouchEnd)},o.prototype.off=function(){this._canvas.removeEventListener("mousedown",this._handleMouseDown),this._canvas.removeEventListener("mousemove",this._handleMouseMove),t.removeEventListener("mouseup",this._handleMouseUp),this._canvas.removeEventListener("touchstart",this._handleTouchStart),this._canvas.removeEventListener("touchmove",this._handleTouchMove),t.removeEventListener("touchend",this._handleTouchEnd)},o.prototype.isEmpty=function(){return this._isEmpty},o.prototype._reset=function(){this.points=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._isEmpty=!0,this._ctx.fillStyle=this.penColor},o.prototype._createPoint=function(t){var o=this._canvas.getBoundingClientRect();return new e(t.clientX-o.left,t.clientY-o.top)},o.prototype._addPoint=function(t){var o,e,i,s,h=this.points;h.push(t),h.length>2&&(3===h.length&&h.unshift(h[0]),s=this._calculateCurveControlPoints(h[0],h[1],h[2]),o=s.c2,s=this._calculateCurveControlPoints(h[1],h[2],h[3]),e=s.c1,i=new n(h[1],o,e,h[2]),this._addCurve(i),h.shift())},o.prototype._calculateCurveControlPoints=function(t,o,n){var i=t.x-o.x,s=t.y-o.y,h=o.x-n.x,r=o.y-n.y,a={x:(t.x+o.x)/2,y:(t.y+o.y)/2},c={x:(o.x+n.x)/2,y:(o.y+n.y)/2},u=Math.sqrt(i*i+s*s),d=Math.sqrt(h*h+r*r),l=a.x-c.x,_=a.y-c.y,v=d/(u+d),p={x:c.x+l*v,y:c.y+_*v},y=o.x-p.x,f=o.y-p.y;return{c1:new e(a.x+y,a.y+f),c2:new e(c.x+y,c.y+f)}},o.prototype._addCurve=function(t){var o,e,n=t.startPoint,i=t.endPoint;o=i.velocityFrom(n),o=this.velocityFilterWeight*o+(1-this.velocityFilterWeight)*this._lastVelocity,e=this._strokeWidth(o),this._drawCurve(t,this._lastWidth,e),this._lastVelocity=o,this._lastWidth=e},o.prototype._drawPoint=function(t,o,e){var n=this._ctx;n.moveTo(t,o),n.arc(t,o,e,0,2*Math.PI,!1),this._isEmpty=!1},o.prototype._drawCurve=function(t,o,e){var n,i,s,h,r,a,c,u,d,l,_,v=this._ctx,p=e-o;for(n=Math.floor(t.length()),v.beginPath(),s=0;n>s;s++)h=s/n,r=h*h,a=r*h,c=1-h,u=c*c,d=u*c,l=d*t.startPoint.x,l+=3*u*h*t.control1.x,l+=3*c*r*t.control2.x,l+=a*t.endPoint.x,_=d*t.startPoint.y,_+=3*u*h*t.control1.y,_+=3*c*r*t.control2.y,_+=a*t.endPoint.y,i=o+a*p,this._drawPoint(l,_,i);v.closePath(),v.fill()},o.prototype._strokeWidth=function(t){return Math.max(this.maxWidth/(t+1),this.minWidth)};var e=function(t,o,e){this.x=t,this.y=o,this.time=e||(new Date).getTime()};e.prototype.velocityFrom=function(t){return this.time!==t.time?this.distanceTo(t)/(this.time-t.time):1},e.prototype.distanceTo=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))};var n=function(t,o,e,n){this.startPoint=t,this.control1=o,this.control2=e,this.endPoint=n};return n.prototype.length=function(){var t,o,e,n,i,s,h,r,a=10,c=0;for(t=0;a>=t;t++)o=t/a,e=this._point(o,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),n=this._point(o,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y),t>0&&(h=e-i,r=n-s,c+=Math.sqrt(h*h+r*r)),i=e,s=n;return c},n.prototype._point=function(t,o,e,n,i){return o*(1-t)*(1-t)*(1-t)+3*e*(1-t)*(1-t)*t+3*n*(1-t)*t*t+i*t*t*t},o}(document);return t});