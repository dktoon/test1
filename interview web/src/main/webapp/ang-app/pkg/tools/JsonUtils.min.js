"use strict";function ToJsonString(t){return _ToJsonString([],[1],t)}function _ToJsonString(t,r,n){if(null==n||n instanceof Date||"object"!=typeof n)return JSON.stringify(n);if(void 0!==t[n])return"{$ref:"+t[n]+"}";var o="";if(Array.isArray(n)){o="[";for(var e=0;e<n.length;e++)o+=_ToJsonString(t,r,n[e])+(e<n.length-1?",":"");return o+="]"}t[n]=r[0],o="{",o+="$id:"+r[0]+",",r[0]++;for(var i in n)n.hasOwnProperty(i)&&(o+="'"+i+"': "+_ToJsonString(t,r,n[i])+",");return o+="},"}Package("tools").JsonUtils={regexIso8601:/^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}Z$/,toJsonCycle:function(t){return this._toJsonCycle([],null,null,t)},_toJsonCycle:function(t,r,n,o){if(null==o||o instanceof Date||"object"!=typeof o)return o;if(Array.isArray(o)){for(var e=0;e<o.length;e++)this._toJsonCycle(t,o,e,o[e]);return o}if(void 0!==o.$id&&(t[o.$id]=o,delete o.$id),void 0!==o.$ref)return r[n]=t[o.$ref],r[n];for(var i in o)o.hasOwnProperty(i)&&this._toJsonCycle(t,o,i,o[i]);return o},toJsonRef:function(t){return Import("tools.Clone"),t=this._toJsonRef([1],null,null,PKG.tools.Clone.clone(t))},_toJsonRef:function(t,r,n,o){if(null==o||o instanceof Date||"object"!=typeof o)return o;if(Array.isArray(o)){for(var e=0;e<o.length;e++)this._toJsonRef(t,o,e,o[e]);return o}if(void 0===o.$id){o.$id=t[0]+"",t[0]++;for(var i in o)o.hasOwnProperty(i)&&this._toJsonRef(t,o,i,o[i]);return o}return r[n]={$ref:o.$id},r[n]},convertDateStringsToDates:function(t){if("object"!=typeof t)return t;for(var r in t)if(t.hasOwnProperty(r)){var n,o=t[r];if("string"==typeof o&&o.length>10&&(n=o.match(this.regexIso8601))){var e=Date.parse(n[0]);isNaN(e)||(t[r]=new Date(e))}else"object"==typeof o&&this.convertDateStringsToDates(o)}}};